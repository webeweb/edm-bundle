{# Resources/views/Dropzone/upload/javascript.html.twig #}
{% set _formID = form.vars.id %}
<script type="text/javascript">
    $(document).ready(function () {

        Dropzone.autoDiscover = false;

        var $edmDropzone = $('[name="{{ _formID }}"]');
        $edmDropzone.addClass("dropzone");
        $edmDropzone.dropzone({
            init          : function () {
                myself = this;
                $.get("{{ path("wbw_edm_dropzone_index", {"id": document.id|default(null)}) }}", function (data) {
                    $.each(data, function (k, v) {
                        if (null === v) {
                            return;
                        }
                        var f = {
                            id  : v.id,
                            name: v.filename,
                            size: v.size
                        };
                        myself.options.addedfile.call(myself, f);
                        myself.options.thumbnail.call(myself, f, "{{ path("wbw_edm_document_download", {"id": "__id"}) }}".replace("__id", f.id));
                    });
                });
            },
            maxFilesize   : {{ uploadMaxFilesize }},
            paramName     : "{{ form.vars.id }}[uploadedFile]",
            uploadMultiple: false,
            url           : "{{ path("wbw_edm_dropzone_upload", {"id": document.id|default(null)}) }}"
        });

    });
</script>
